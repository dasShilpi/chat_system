const c=$('meta[name="selected_user"]'),r=$('meta[name="auth_id"]').attr("content"),i=$('meta[name="base_url"]').attr("content"),l=document.querySelector('meta[name="csrf-token"]').getAttribute("content");function m(){let e=$('meta[name="selected_user"]').attr("content");$.ajax({method:"GET",url:i+"/fetch-messages",data:{contactId:e},beforeSend:function(){$(".index-loader-container").show()},success:function(t){f(t.contact);let n=$("#conversation");n.empty(),t.messages.forEach(s=>{s.from_id==e?n.append(a(s.message,"message-main-receiver","receiver","sun")):n.append(a(s.message,"message-main-sender","sender","sun"))}),d()},error:function(t,n,s){console.error("Error fetching messages:",s)},complete:function(){$(".index-loader-container").hide()}})}function f(e){$(".heading-name-meta").text(e.name)}function a(e,t,n,s){return`<div class="row message-body">
        <div class="col-sm-12 ${t}">
            <div class="${n}">
                <div class="message-text">
                    ${e}
                </div>
                <span class="message-time pull-right">
                    ${s}
                </span>
            </div>
        </div>
    </div>`}function d(){const e=$(".conversation");e.length>0&&e.animate({scrollTop:e[0].scrollHeight},300)}$(document).ready(function(){$(".contact").on("click",function(){let e=$(this).data("id");c.attr("content",e),m(),$(".blank-wrap").hide()}),$("#send-button").on("click",function(){let e=$('meta[name="selected_user"]').attr("content"),t=$("#comment").val(),n=$("#conversation");if(!(!t||!t.trim())){var s={message:t.trim(),contactId:e,_token:l};$.ajax({url:i+"/send-messages",type:"POST",data:s,success:function(o){$("#responseMessage").html("<p>"+o.message+"</p>"),n.append(a(t,"message-main-sender","sender","sun")),$("#comment").val(""),d()},error:function(o,g,u){$("#responseMessage").html("<p>Error: "+o.responseJSON.message+"</p>")}})}})});window.Echo.private("message."+r).listen("SendMessageEvent",e=>{e.from_id==c.attr("content")&&$("#conversation").append(a(e.message,"message-main-receiver","receiver","sun"))});window.Echo.join("online").here(e=>{console.log("here",e),e.forEach(t=>{console.log(t.id);let n=$(`.contact[data-id="${t.id}"]`);n.length>0?(n.find(".status-dot").removeClass("offline"),n.find(".status-dot").addClass("online")):(n.find(".status-dot").removeClass("online"),n.find(".status-dot").addClass("offline"))})}).joining(e=>{console.log("Joining",e);let t=$(`.contact[data-id="${e.id}"]`);t.find(".status-dot").removeClass("offline"),t.find(".status-dot").addClass("online")}).leaving(e=>{console.log("Leaving",e);let t=$(`.contact[data-id="${e.id}"]`);t.find(".status-dot").removeClass("online"),t.find(".status-dot").addClass("offline")});
